#!/bin/sh
set -e

# ANSI color codes
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
BOLD='\033[1m'
RESET='\033[0m'


# 1. Prevent commit if nothing is staged
echo -e "${BLUE}ğŸ” Checking for staged changes...${RESET}"
if git diff --cached --quiet; then
  echo -e "${YELLOW}âš ï¸  No staged changes to commit. Aborting.${RESET}"
  exit 1
fi

# 2. Lint & format
echo -e "${BLUE}ğŸ” Running lint and format checks...${RESET}"
if bun lint-staged && bun format:check; then
  echo -e "${GREEN}âœ… Lint and format checks passed!${RESET}"
else
  echo -e "${RED}âŒ Lint or format checks failed. Commit aborted.${RESET}"
  exit 1
fi

# 3. Build
echo -e "${BLUE}ğŸ”§ Running build...${RESET}"
if bun run build; then
  echo -e "${GREEN}ğŸ—ï¸  Build completed successfully!${RESET}"
else
  echo -e "${RED}âŒ Build failed. Commit aborted.${RESET}"
  exit 1
fi

# 4. Final confirmation
echo -e "${BOLD}${GREEN}ğŸš€ Committing now â€“ everything is fine!${RESET}"
exit 0